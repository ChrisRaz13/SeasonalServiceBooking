<div class="weather-disclaimer"></div>
  <mat-card>
    <mat-card-content>
      <div class="disclaimer-content">
        <div class="disclaimer-icon">‚ùÑÔ∏è</div>
        <div class="disclaimer-text">
          <p class="primary-text">Weather data provided by the National Weather Service (weather.gov)</p>
          <p class="secondary-text">Service activation is based on snowfall accumulation of 2 inches or more. Updates occur every 60 minutes.</p>
        </div>
        <button mat-button color="primary" (click)="loadWeatherData()" class="refresh-button">
          <span>Refresh Data</span>
        </button>
      </div>
    </mat-card-content>
  </mat-card>


  <!-- Snow Conditions Card -->
<mat-card class="weather-card snow-conditions-card">
  <mat-card-header>
    <mat-card-title>
      <div class="title-with-icon">
        <span class="snow-icon">‚ùÑÔ∏è</span>
        Snow Conditions
      </div>
    </mat-card-title>
    <mat-card-subtitle>Next 24 Hours Outlook</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div class="snow-grid">
      <!-- Snow Probability -->
      <div class="snow-stat-box">
        <div class="stat-label">Snow Chance</div>
        <div class="stat-value">{{ getSnowProbability() }}%</div>
        <div class="stat-period">Next 12 hours</div>
      </div>

      <!-- Expected Accumulation -->
      <div class="snow-stat-box">
        <div class="stat-label">Expected Accumulation</div>
        <div class="stat-value">{{ getSnowAccumulation() }}"</div>
        <div class="stat-period">Total expected</div>
      </div>

      <!-- Service Status -->
      <div class="snow-stat-box" [ngClass]="getServiceStatusClass()">
        <div class="stat-label">Service Status</div>
        <div class="stat-value">{{ getServiceStatus() }}</div>
        <div class="stat-period">Based on forecast</div>
      </div>

      <!-- Ground Temperature -->
      <div class="snow-stat-box">
        <div class="stat-label">Ground Temperature</div>
        <div class="stat-value">{{ getGroundTemperature() }}¬∞F</div>
        <div class="stat-period">Surface conditions</div>
      </div>
    </div>

    <!-- Service Threshold Notice -->
    <div class="service-notice" *ngIf="showServiceNotice()">
      <p>üö® Approaching service threshold (2" accumulation)</p>
      <button mat-raised-button color="primary">Schedule Service</button>
    </div>
  </mat-card-content>
</mat-card>


<!-- Background Animation -->
<div id="particles-js" class="particles-container"></div>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container" @fadeSlideInOut>
  <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
  <p class="loading-text">Loading weather data...</p>
</div>

<!-- Error State -->
<div *ngIf="hasError" class="error-container" @fadeSlideInOut>
  <mat-card>
    <mat-card-content>
      <div class="error-content">
        <h2>‚ö†Ô∏è Unable to load weather data</h2>
        <p>Please try again later or check your connection.</p>
        <button mat-flat-button color="primary" (click)="loadWeatherData()">
          Retry
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<!-- Main Content -->
<div *ngIf="!isLoading && !hasError" class="dashboard-container" @scaleIn>
  <!-- Weather Status Header -->
  <div class="weather-status">
    <h1>Weather Dashboard</h1>
    <p class="location">Iowa City, IA</p>
  </div>

  <!-- Active Weather Alerts -->
  <div *ngIf="weatherAlerts.length > 0" class="alerts-banner" @fadeSlideInOut>
    <div *ngFor="let alert of weatherAlerts"
         class="alert-item"
         [style.background-color]="getSeverityColor(alert.severity)">
      <div class="alert-header">
        <span class="alert-icon">‚ö†Ô∏è</span>
        <strong>{{ alert.event }}</strong>
      </div>
      <div class="alert-body">
        <p class="alert-headline">{{ alert.headline }}</p>
        <div class="alert-details">
          <p>{{ alert.description }}</p>
          <p *ngIf="alert.instruction"><strong>Instructions:</strong> {{ alert.instruction }}</p>
          <p><strong>Expires:</strong> {{ alert.expires | date:'short' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weather Dashboard Grid -->
  <div class="dashboard-grid">
    <!-- Temperature Chart -->
    <mat-card class="weather-card chart-card">
      <mat-card-header>
        <mat-card-title>Temperature Trend</mat-card-title>
        <mat-card-subtitle>Next 24 Hours</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <p-chart type="line"
                  [data]="temperatureData"
                  [options]="temperatureOptions"
                  height="300px">
          </p-chart>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Wind Speed Chart -->
    <mat-card class="weather-card chart-card">
      <mat-card-header>
        <mat-card-title>Wind Speed Trend</mat-card-title>
        <mat-card-subtitle>Next 24 Hours</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <p-chart type="line"
                  [data]="windSpeedData"
                  [options]="windSpeedOptions"
                  height="300px">
          </p-chart>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Hourly Forecast -->
    <mat-card class="weather-card hourly-card">
      <mat-card-header>
        <mat-card-title>Hourly Forecast</mat-card-title>
        <mat-card-subtitle>Detailed hourly conditions</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="hourly-scroll custom-scrollbar">
          <div *ngFor="let item of hourlyForecast"
               [ngClass]="{'hourly-item': !item.isDateSeparator, 'date-separator': item.isDateSeparator}">
            <ng-container *ngIf="!item.isDateSeparator">
              <div class="time">{{ item.time }}</div>
              <div class="weather-emoji">{{ getWeatherEmoji(item.shortForecast || '') }}</div>
              <div class="temp">{{ item.temperature }}</div>
              <div class="wind">{{ item.windSpeed }}</div>
              <div class="forecast">{{ item.shortForecast }}</div>
            </ng-container>
            <ng-container *ngIf="item.isDateSeparator">
              {{ item.date }}
            </ng-container>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Weekly Forecast -->
    <mat-card class="weather-card forecast-card">
      <mat-card-header>
        <mat-card-title>7-Day Forecast</mat-card-title>
        <mat-card-subtitle>Extended weather outlook</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-tab-group animationDuration="200ms" class="custom-tabs">
          <mat-tab *ngFor="let forecast of weatherForecast">
            <ng-template mat-tab-label>
              <div class="tab-label">
                <span class="day">{{ forecast.date }}</span>
                <span class="temp-range" *ngIf="forecast.tempHigh && forecast.tempLow">
                  {{ forecast.tempHigh }}¬∞ / {{ forecast.tempLow }}¬∞
                </span>
                <span class="emoji">{{ getWeatherEmoji(forecast.shortForecast || '') }}</span>
              </div>
            </ng-template>

            <div class="forecast-content">
              <div class="forecast-period"
                   *ngFor="let period of forecast.periods"
                   [class.day-period]="period.isDaytime"
                   [class.night-period]="!period.isDaytime">
                <div class="period-header">
                  <div class="period-time">
                    <span class="time-label">{{ period.timeOfDay }}</span>
                    <span class="weather-emoji">{{ getWeatherEmoji(period.shortForecast) }}</span>
                  </div>
                  <div class="period-temp">{{ period.temperature }}¬∞{{ period.temperatureUnit }}</div>
                </div>

                <div class="period-details">
                  <div class="short-forecast">{{ period.shortForecast }}</div>
                  <div class="wind-info">
                    <span class="wind-speed">{{ period.windSpeed }}</span>
                    <span class="wind-direction">{{ period.windDirection }}</span>
                  </div>
                  <div class="detailed-forecast">{{ period.detailedForecast }}</div>
                </div>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Last Updated Footer -->
  <div class="update-footer">
    <p>Last updated: {{ lastUpdated | date:'medium' }}</p>
    <button mat-button color="primary" (click)="loadWeatherData()">
      <span>Refresh</span>
    </button>
  </div>
</div>
